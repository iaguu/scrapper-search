<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Query Bridge - Painel de Controle</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @keyframes pulse-border {
            0%, 100% { border-color: rgb(34 197 94); }
            50% { border-color: rgb(74 222 128); }
        }
        .status-online { animation: pulse-border 2s infinite; }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 min-h-screen text-white">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-10">
            <div class="flex justify-center items-center gap-3 mb-4">
                <i data-lucide="send" class="w-10 h-10 text-purple-400"></i>
                <h1 class="text-4xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent">
                    Telegram Query Bridge
                </h1>
                <i data-lucide="bot" class="w-10 h-10 text-purple-400"></i>
            </div>
            <p class="text-gray-300 text-lg">Painel de Controle - Gerenciamento de API e Serviços</p>
        </header>

        <!-- Status Cards -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-10">
            <!-- Python Service Status -->
            <div class="glass-effect rounded-xl p-6 border-2 border-gray-600 hover:border-purple-500 transition-all">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <div class="w-3 h-3 bg-green-500 rounded-full" id="python-status"></div>
                        <h3 class="text-xl font-semibold">Python Service</h3>
                    </div>
                    <i data-lucide="server" class="w-6 h-6 text-purple-400"></i>
                </div>
                <div class="space-y-2">
                    <p class="text-sm text-gray-300">Porta: <span class="text-green-400 font-mono">8000</span></p>
                    <p class="text-sm text-gray-300">Status: <span id="python-status-text" class="text-yellow-400">Verificando...</span></p>
                    <button onclick="checkPythonHealth()" class="w-full bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                        Verificar Status
                    </button>
                </div>
            </div>

            <!-- Node.js API Status -->
            <div class="glass-effect rounded-xl p-6 border-2 border-gray-600 hover:border-purple-500 transition-all">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <div class="w-3 h-3 bg-gray-500 rounded-full" id="node-status"></div>
                        <h3 class="text-xl font-semibold">Node.js API</h3>
                    </div>
                    <i data-lucide="api" class="w-6 h-6 text-purple-400"></i>
                </div>
                <div class="space-y-2">
                    <p class="text-sm text-gray-300">Porta: <span class="text-green-400 font-mono">3000</span></p>
                    <p class="text-sm text-gray-300">Status: <span id="node-status-text" class="text-yellow-400">Verificando...</span></p>
                    <button onclick="checkNodeHealth()" class="w-full bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                        Verificar Status
                    </button>
                </div>
            </div>

            <!-- System Info -->
            <div class="glass-effect rounded-xl p-6 border-2 border-gray-600 hover:border-purple-500 transition-all">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <div class="w-3 h-3 bg-blue-500 rounded-full"></div>
                        <h3 class="text-xl font-semibold">Sistema</h3>
                    </div>
                    <i data-lucide="monitor" class="w-6 h-6 text-purple-400"></i>
                </div>
                <div class="space-y-2">
                    <p class="text-sm text-gray-300">Ambiente: <span class="text-blue-400 font-mono" id="environment">Produção</span></p>
                    <p class="text-sm text-gray-300">Versão: <span class="text-blue-400 font-mono">v1.0.0</span></p>
                    <button onclick="toggleEnvironment()" class="w-full bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2">
                        <i data-lucide="settings" class="w-4 h-4"></i>
                        Alternar Ambiente
                    </button>
                </div>
            </div>
        </div>

        <!-- Control Panel -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-10">
            <!-- Service Controls -->
            <div class="glass-effect rounded-xl p-6 border-2 border-gray-600">
                <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
                    <i data-lucide="sliders" class="w-6 h-6 text-purple-400"></i>
                    Controle de Serviços
                </h2>
                
                <div class="space-y-4">
                    <div class="flex gap-3">
                        <button onclick="startAllServices()" class="flex-1 bg-green-600 hover:bg-green-700 px-4 py-3 rounded-lg transition-colors flex items-center justify-center gap-2">
                            <i data-lucide="play" class="w-5 h-5"></i>
                            Iniciar Todos
                        </button>
                        <button onclick="stopAllServices()" class="flex-1 bg-red-600 hover:bg-red-700 px-4 py-3 rounded-lg transition-colors flex items-center justify-center gap-2">
                            <i data-lucide="square" class="w-5 h-5"></i>
                            Parar Todos
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <button onclick="startPython()" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2">
                            <i data-lucide="play-circle" class="w-4 h-4"></i>
                            Python
                        </button>
                        <button onclick="startNode()" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2">
                            <i data-lucide="play-circle" class="w-4 h-4"></i>
                            Node.js
                        </button>
                        <button onclick="stopPython()" class="bg-orange-600 hover:bg-orange-700 px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2">
                            <i data-lucide="stop-circle" class="w-4 h-4"></i>
                            Python
                        </button>
                        <button onclick="stopNode()" class="bg-orange-600 hover:bg-orange-700 px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2">
                            <i data-lucide="stop-circle" class="w-4 h-4"></i>
                            Node.js
                        </button>
                    </div>
                </div>
            </div>

            <!-- API Testing -->
            <div class="glass-effect rounded-xl p-6 border-2 border-gray-600">
                <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
                    <i data-lucide="test-tube" class="w-6 h-6 text-purple-400"></i>
                    Testes de API
                </h2>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium mb-2">Tipo de Consulta</label>
                        <select id="queryType" class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 focus:border-purple-500 focus:outline-none">
                            <option value="cpf">CPF</option>
                            <option value="telefone">Telefone</option>
                            <option value="placa">Placa</option>
                            <option value="nome">Nome</option>
                            <option value="email">Email</option>
                            <option value="cep">CEP</option>
                            <option value="cnpj">CNPJ</option>
                            <option value="foto">Foto</option>
                            <option value="titulo">Título</option>
                            <option value="mae">Mãe</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">Dados da Consulta</label>
                        <input type="text" id="queryData" placeholder="Ex: 12345678901" 
                               class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 focus:border-purple-500 focus:outline-none">
                    </div>
                    
                    <button onclick="testQuery()" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 px-4 py-3 rounded-lg transition-all flex items-center justify-center gap-2">
                        <i data-lucide="search" class="w-5 h-5"></i>
                        Executar Consulta
                    </button>
                    
                    <div id="testResult" class="hidden bg-gray-800 border border-gray-600 rounded-lg p-4 max-h-40 overflow-y-auto">
                        <pre class="text-sm text-green-400 whitespace-pre-wrap"></pre>
                    </div>
                </div>
            </div>
        </div>

        <!-- Button Testing -->
        <div class="glass-effect rounded-xl p-6 border-2 border-gray-600 mb-10">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
                <i data-lucide="mouse-pointer-click" class="w-6 h-6 text-purple-400"></i>
                Testes de Botões Interativos
            </h2>
            
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <button onclick="testButton('Ver no Privado')" class="bg-purple-600 hover:bg-purple-700 px-4 py-3 rounded-lg transition-colors flex items-center justify-center gap-2">
                    <i data-lucide="lock" class="w-4 h-4"></i>
                    Ver Privado
                </button>
                <button onclick="testButton('Ver Resumo')" class="bg-purple-600 hover:bg-purple-700 px-4 py-3 rounded-lg transition-colors flex items-center justify-center gap-2">
                    <i data-lucide="file-text" class="w-4 h-4"></i>
                    Ver Resumo
                </button>
                <button onclick="testButton('Baixar TXT')" class="bg-purple-600 hover:bg-purple-700 px-4 py-3 rounded-lg transition-colors flex items-center justify-center gap-2">
                    <i data-lucide="download" class="w-4 h-4"></i>
                    Baixar TXT
                </button>
                <button onclick="testButton('Fechar')" class="bg-purple-600 hover:bg-purple-700 px-4 py-3 rounded-lg transition-colors flex items-center justify-center gap-2">
                    <i data-lucide="x" class="w-4 h-4"></i>
                    Fechar
                </button>
            </div>
            
            <div id="buttonResult" class="hidden bg-gray-800 border border-gray-600 rounded-lg p-4 mt-4 max-h-40 overflow-y-auto">
                <pre class="text-sm text-blue-400 whitespace-pre-wrap"></pre>
            </div>
        </div>

        <!-- Configuration -->
        <div class="glass-effect rounded-xl p-6 border-2 border-gray-600">
            <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
                <i data-lucide="settings-2" class="w-6 h-6 text-purple-400"></i>
                Configuração de Produção
            </h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                    <h3 class="text-lg font-semibold mb-4">Variáveis de Ambiente</h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium mb-1">API Key</label>
                            <input type="password" id="apiKey" placeholder="Sua API Key" 
                                   class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 focus:border-purple-500 focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Telegram API ID</label>
                            <input type="text" id="apiId" placeholder="Telegram API ID" 
                                   class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 focus:border-purple-500 focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Telegram API Hash</label>
                            <input type="password" id="apiHash" placeholder="Telegram API Hash" 
                                   class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 focus:border-purple-500 focus:outline-none">
                        </div>
                    </div>
                </div>
                
                <div>
                    <h3 class="text-lg font-semibold mb-4">Configurações de Serviço</h3>
                    <div class="space-y-3">
                        <div>
                            <label class="block text-sm font-medium mb-1">Chat ID</label>
                            <input type="text" id="chatId" placeholder="ID do Grupo Telegram" 
                                   class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 focus:border-purple-500 focus:outline-none">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Phone Number</label>
                            <input type="tel" id="phoneNumber" placeholder="+55XXXXXXXXXXX" 
                                   class="w-full bg-gray-800 border border-gray-600 rounded-lg px-4 py-2 focus:border-purple-500 focus:outline-none">
                        </div>
                        <button onclick="saveConfiguration()" class="w-full bg-green-600 hover:bg-green-700 px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2">
                            <i data-lucide="save" class="w-4 h-4"></i>
                            Salvar Configuração
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Log Console -->
        <div class="glass-effect rounded-xl p-6 border-2 border-gray-600 mt-10">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold flex items-center gap-3">
                    <i data-lucide="terminal" class="w-6 h-6 text-purple-400"></i>
                    Console de Logs
                </h2>
                <button onclick="clearLogs()" class="bg-gray-600 hover:bg-gray-700 px-3 py-1 rounded text-sm transition-colors">
                    Limpar
                </button>
            </div>
            <div id="logConsole" class="bg-black rounded-lg p-4 h-40 overflow-y-auto font-mono text-sm text-green-400">
                <div>[Sistema] Painel inicializado</div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Global variables
        let isProduction = true;
        let lastCommand = '';

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            checkAllServices();
            setInterval(checkAllServices, 10000); // Check every 10 seconds
            loadConfiguration();
        });

        // Service Health Checks
        async function checkPythonHealth() {
            try {
                const response = await fetch('http://localhost:8000/health');
                const data = await response.json();
                updateStatus('python', true, data.status);
                addLog('[Python] Serviço online: ' + data.status);
            } catch (error) {
                updateStatus('python', false, 'Offline');
                addLog('[Python] Serviço offline: ' + error.message);
            }
        }

        async function checkNodeHealth() {
            try {
                const response = await fetch('http://localhost:3000/health');
                const data = await response.json();
                updateStatus('node', true, data.status);
                addLog('[Node.js] API online: ' + data.status);
            } catch (error) {
                updateStatus('node', false, 'Offline');
                addLog('[Node.js] API offline: ' + error.message);
            }
        }

        function checkAllServices() {
            checkPythonHealth();
            checkNodeHealth();
        }

        function updateStatus(service, isOnline, status) {
            const statusDot = document.getElementById(`${service}-status`);
            const statusText = document.getElementById(`${service}-status-text`);
            
            if (isOnline) {
                statusDot.className = 'w-3 h-3 bg-green-500 rounded-full status-online';
                statusText.textContent = status;
                statusText.className = 'text-green-400';
            } else {
                statusDot.className = 'w-3 h-3 bg-red-500 rounded-full';
                statusText.textContent = 'Offline';
                statusText.className = 'text-red-400';
            }
        }

        // Service Controls
        async function startAllServices() {
            addLog('[Sistema] Iniciando todos os serviços...');
            await startPython();
            await new Promise(resolve => setTimeout(resolve, 3000));
            await startNode();
        }

        async function stopAllServices() {
            addLog('[Sistema] Parando todos os serviços...');
            await stopPython();
            await stopNode();
        }

        async function startPython() {
            addLog('[Python] Iniciando serviço...');
            // In real implementation, this would call backend API to start service
            setTimeout(() => checkPythonHealth(), 2000);
        }

        async function startNode() {
            addLog('[Node.js] Iniciando API...');
            // In real implementation, this would call backend API to start service
            setTimeout(() => checkNodeHealth(), 2000);
        }

        async function stopPython() {
            addLog('[Python] Parando serviço...');
            // In real implementation, this would call backend API to stop service
            setTimeout(() => checkPythonHealth(), 1000);
        }

        async function stopNode() {
            addLog('[Node.js] Parando API...');
            // In real implementation, this would call backend API to stop service
            setTimeout(() => checkNodeHealth(), 1000);
        }

        // API Testing
        async function testQuery() {
            const type = document.getElementById('queryType').value;
            const query = document.getElementById('queryData').value;
            
            if (!query) {
                alert('Por favor, insira os dados para consulta');
                return;
            }

            addLog(`[API] Testando consulta: ${type} - ${query}`);
            
            try {
                const response = await fetch('http://localhost:3000/query', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': document.getElementById('apiKey').value || 'demo_key_12345'
                    },
                    body: JSON.stringify({ type, query })
                });
                
                const data = await response.json();
                lastCommand = `/${type} ${query}`;
                
                const resultDiv = document.getElementById('testResult');
                resultDiv.querySelector('pre').textContent = JSON.stringify(data, null, 2);
                resultDiv.classList.remove('hidden');
                
                addLog('[API] Consulta executada com sucesso');
            } catch (error) {
                addLog('[API] Erro na consulta: ' + error.message);
            }
        }

        async function testButton(buttonText) {
            if (!lastCommand) {
                alert('Por favor, execute uma consulta primeiro');
                return;
            }

            addLog(`[Botão] Testando botão: ${buttonText}`);
            
            try {
                const response = await fetch('http://localhost:3000/button', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-API-Key': document.getElementById('apiKey').value || 'demo_key_12345'
                    },
                    body: JSON.stringify({ 
                        button_text: buttonText, 
                        original_command: lastCommand 
                    })
                });
                
                const data = await response.json();
                
                const resultDiv = document.getElementById('buttonResult');
                resultDiv.querySelector('pre').textContent = JSON.stringify(data, null, 2);
                resultDiv.classList.remove('hidden');
                
                addLog('[Botão] Ação executada com sucesso');
            } catch (error) {
                addLog('[Botão] Erro na ação: ' + error.message);
            }
        }

        // Configuration
        function toggleEnvironment() {
            isProduction = !isProduction;
            const envElement = document.getElementById('environment');
            envElement.textContent = isProduction ? 'Produção' : 'Desenvolvimento';
            envElement.className = isProduction ? 'text-blue-400 font-mono' : 'text-yellow-400 font-mono';
            addLog(`[Sistema] Ambiente alterado para: ${isProduction ? 'Produção' : 'Desenvolvimento'}`);
        }

        function loadConfiguration() {
            // Load from localStorage or .env file
            const config = {
                apiKey: localStorage.getItem('apiKey') || '',
                apiId: localStorage.getItem('apiId') || '',
                apiHash: localStorage.getItem('apiHash') || '',
                chatId: localStorage.getItem('chatId') || '',
                phoneNumber: localStorage.getItem('phoneNumber') || ''
            };
            
            Object.keys(config).forEach(key => {
                const element = document.getElementById(key);
                if (element) element.value = config[key];
            });
        }

        function saveConfiguration() {
            const config = {
                apiKey: document.getElementById('apiKey').value,
                apiId: document.getElementById('apiId').value,
                apiHash: document.getElementById('apiHash').value,
                chatId: document.getElementById('chatId').value,
                phoneNumber: document.getElementById('phoneNumber').value
            };
            
            Object.keys(config).forEach(key => {
                localStorage.setItem(key, config[key]);
            });
            
            addLog('[Config] Configurações salvas com sucesso');
            alert('Configurações salvas com sucesso!');
        }

        // Logging
        function addLog(message) {
            const logConsole = document.getElementById('logConsole');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${timestamp}] ${message}`;
            logConsole.appendChild(logEntry);
            logConsole.scrollTop = logConsole.scrollHeight;
        }

        function clearLogs() {
            const logConsole = document.getElementById('logConsole');
            logConsole.innerHTML = '<div>[Sistema] Logs limpos</div>';
        }
    </script>
</body>
</html>
